<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0a0a14">
  <meta name="description" content="STRIVE ‚Äî 30 Day Challenge Tracker">
  <link rel="manifest" href="manifest.json">
  <title>STRIVE ‚Äî 30 Day Challenge</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&family=JetBrains+Mono:wght@400;600&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --bg: #0a0a14;
      --bg2: #111120;
      --bg3: #1a1a2e;
      --border: rgba(255, 255, 255, 0.07);
      --text: #e8e8f0;
      --muted: #6b7280;
      --accent: #6366f1;
      --accent2: #8b5cf6;
      --green: #10b981;
      --yellow: #f59e0b;
      --red: #ef4444;
      --cyan: #06b6d4;
      --glow: rgba(99, 102, 241, 0.3);
    }

    :root.light-mode {
      --bg: #f8fafc;
      --bg2: #ffffff;
      --bg3: #f1f5f9;
      --border: rgba(0, 0, 0, 0.06);
      --text: #0f172a;
      --muted: #64748b;
      --accent: #6366f1;
      --accent2: #4f46e5;
      --green: #10b981;
      --yellow: #f59e0b;
      --red: #ef4444;
      --cyan: #06b6d4;
      --glow: rgba(99, 102, 241, 0.15);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
      transition: background 0.3s, color 0.3s;
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image: linear-gradient(rgba(99, 102, 241, 0.025) 1px, transparent 1px), linear-gradient(90deg, rgba(99, 102, 241, 0.025) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
      z-index: 0;
      opacity: var(--grid-opacity, 1);
    }

    :root.light-mode body::before {
      --grid-opacity: 0.4;
    }

    nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(10, 10, 20, 0.9);
      backdrop-filter: blur(24px);
      border-bottom: 1px solid var(--border);
      z-index: 100;
      padding: 0 20px;
      height: 62px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .logo {
      font-family: 'Bebas Neue', cursive;
      font-size: 26px;
      letter-spacing: 4px;
      background: linear-gradient(135deg, var(--accent), var(--cyan));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      flex-shrink: 0;
    }

    .nav-tabs {
      display: flex;
      gap: 2px;
      background: var(--bg3);
      padding: 4px;
      border-radius: 12px;
      border: 1px solid var(--border);
      overflow-x: auto;
    }

    .nav-tab {
      padding: 6px 14px;
      border-radius: 8px;
      border: none;
      background: transparent;
      color: var(--muted);
      font-family: 'DM Sans', sans-serif;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }
/* Update the existing nav-tabs class */
.nav-tabs {
  display: flex;
  gap: 2px;
  background: var(--bg3);
  padding: 4px;
  border-radius: 12px;
  border: 1px solid var(--border);
  /* Ensures it can scroll horizontally if tabs exceed width */
  overflow-x: auto; 
  scrollbar-width: none; /* Hides scrollbar for Firefox */
  -webkit-overflow-scrolling: touch;
}

.nav-tabs::-webkit-scrollbar {
  display: none; /* Hides scrollbar for Chrome/Safari */
}

/* Add this Media Query for Mobile Optimization */
@media (max-width: 600px) {
  nav {
    height: auto;
    padding: 10px;
    flex-direction: column; /* Stacks Logo and Menu */
    gap: 8px;
  }

  .nav-tabs-container {
    width: 100%;
    justify-content: center;
  }

  .nav-tabs {
    width: 100%;
    justify-content: flex-start;
    padding: 2px;
  }

  .nav-tab {
    padding: 8px 12px;
    font-size: 12px; /* Slightly smaller text for mobile */
  }
}
    
    .nav-tab.active {
      background: var(--accent);
      color: white;
      box-shadow: 0 0 20px var(--glow);
    }

    .nav-tab:hover:not(.active) {
      color: var(--text);
    }

    main {
      padding: 80px 20px 40px;
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    .section {
      display: none;
    }

    .section.active {
      display: block;
      animation: fadeUp 0.3s ease;
    }

    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(10px)
      }

      to {
        opacity: 1;
        transform: translateY(0)
      }
    }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 28px;
      flex-wrap: wrap;
    }

    .page-title {
      font-family: 'Bebas Neue', cursive;
      font-size: 44px;
      letter-spacing: 2px;
      line-height: 1;
    }

    .page-title span {
      background: linear-gradient(135deg, var(--accent), var(--cyan));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .page-sub {
      color: var(--muted);
      font-size: 14px;
      margin-top: 4px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 14px;
      margin-bottom: 28px;
    }

    .stat-card {
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 18px;
      position: relative;
      overflow: hidden;
      transition: transform 0.2s, border-color 0.2s;
    }

    .stat-card:hover {
      transform: translateY(-2px);
      border-color: rgba(255, 255, 255, 0.12);
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--card-color, var(--accent));
    }

    .stat-icon {
      font-size: 20px;
      margin-bottom: 10px;
    }

    .stat-value {
      font-family: 'Bebas Neue', cursive;
      font-size: 36px;
      letter-spacing: 1px;
      line-height: 1;
      color: var(--card-color, var(--text));
    }

    .stat-label {
      font-size: 11px;
      color: var(--muted);
      margin-top: 3px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .charts-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 18px;
      margin-bottom: 28px;
    }

    .chart-card {
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 22px;
    }

    .chart-title {
      font-size: 12px;
      font-weight: 600;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 18px;
    }

    .heatmap {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 3px;
    }

    .heatmap-cell {
      aspect-ratio: 1;
      border-radius: 3px;
      background: var(--bg3);
      border: 1px solid var(--border);
      transition: transform 0.15s;
      cursor: default;
    }

    .heatmap-cell[data-level="1"] {
      background: rgba(99, 102, 241, 0.2);
      border-color: rgba(99, 102, 241, 0.2);
    }

    .heatmap-cell[data-level="2"] {
      background: rgba(99, 102, 241, 0.45);
      border-color: rgba(99, 102, 241, 0.45);
    }

    .heatmap-cell[data-level="3"] {
      background: rgba(99, 102, 241, 0.7);
      border-color: rgba(99, 102, 241, 0.7);
    }

    .heatmap-cell[data-level="4"] {
      background: var(--accent);
      border-color: var(--accent);
      box-shadow: 0 0 6px var(--glow);
    }

    .heatmap-cell:hover {
      transform: scale(1.25);
      z-index: 5;
    }

    .bar-chart {
      display: flex;
      align-items: flex-end;
      gap: 5px;
      height: 110px;
    }

    .bar-wrap {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100%;
      justify-content: flex-end;
      gap: 4px;
    }

    .bar {
      width: 100%;
      border-radius: 4px 4px 0 0;
      background: linear-gradient(180deg, var(--accent), var(--accent2));
      min-height: 3px;
      transition: height 0.5s cubic-bezier(.34, 1.56, .64, 1);
    }

    .bar-label {
      font-size: 9px;
      color: var(--muted);
      font-family: 'JetBrains Mono', monospace;
    }

    .ring-container {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .ring-svg {
      flex-shrink: 0;
    }

    .ring-legend {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .ring-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
    }

    .ring-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .ring-pct {
      font-family: 'JetBrains Mono', monospace;
      font-size: 11px;
      color: var(--muted);
      margin-left: auto;
    }

    .challenges-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(310px, 1fr));
      gap: 18px;
    }

    .challenge-card {
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 22px;
      position: relative;
      overflow: hidden;
      transition: transform 0.2s, border-color 0.2s, box-shadow 0.2s;
    }

    .challenge-card:hover {
      transform: translateY(-3px);
      border-color: rgba(255, 255, 255, 0.11);
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.25);
    }

    .challenge-card-accent {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
    }

    .challenge-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 14px;
    }

    .cat-badge {
      font-size: 11px;
      padding: 3px 9px;
      border-radius: 99px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.8px;
    }

    .card-actions {
      display: flex;
      gap: 5px;
    }

    .btn-icon {
      width: 28px;
      height: 28px;
      border-radius: 7px;
      border: 1px solid var(--border);
      background: var(--bg3);
      color: var(--muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      transition: all 0.15s;
    }

    .btn-icon:hover {
      color: var(--text);
      border-color: rgba(255, 255, 255, 0.14);
    }

    .btn-icon.danger:hover {
      color: var(--red);
      border-color: var(--red);
    }

    .challenge-name {
      font-family: 'Bebas Neue', cursive;
      font-size: 22px;
      letter-spacing: 1px;
      margin-bottom: 5px;
    }

    .challenge-desc {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 14px;
      line-height: 1.5;
    }

    .progress-meta {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 5px;
    }

    .progress-day {
      font-family: 'JetBrains Mono', monospace;
      font-weight: 600;
      color: var(--text);
    }

    .progress-bar {
      height: 5px;
      background: var(--bg3);
      border-radius: 99px;
      overflow: hidden;
      margin-bottom: 14px;
    }

    .progress-fill {
      height: 100%;
      border-radius: 99px;
      transition: width 0.6s cubic-bezier(.34, 1.56, .64, 1);
    }

    .day-dots {
      display: flex;
      flex-wrap: wrap;
      gap: 3px;
      margin-bottom: 14px;
    }

    .day-dot {
      width: 17px;
      height: 17px;
      border-radius: 3px;
      background: var(--bg3);
      border: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 7px;
      color: var(--muted);
      cursor: pointer;
      transition: all 0.15s;
      font-family: 'JetBrains Mono', monospace;
      user-select: none;
    }

    .day-dot:hover {
      transform: scale(1.25);
      z-index: 2;
    }

    .day-dot.completed {
      color: white;
    }

    .card-footer {
      display: flex;
      gap: 8px;
    }

    .btn-check {
      flex: 1;
      padding: 9px;
      border-radius: 9px;
      border: none;
      background: var(--accent);
      color: white;
      font-family: 'DM Sans', sans-serif;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 0 16px var(--glow);
    }

    .btn-check:hover:not(:disabled) {
      background: var(--accent2);
      transform: translateY(-1px);
    }

    .btn-check:disabled {
      cursor: default;
      transform: none;
    }

    .btn-check.done-today {
      background: var(--green);
      box-shadow: 0 0 16px rgba(16, 185, 129, 0.3);
    }

    .btn-check.challenge-complete {
      background: linear-gradient(135deg, #f59e0b, #f97316);
      box-shadow: 0 0 16px rgba(245, 158, 11, 0.3);
    }

    .streak-badge {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 6px 10px;
      background: var(--bg3);
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 12px;
      font-family: 'JetBrains Mono', monospace;
      white-space: nowrap;
    }

    .btn-primary {
      padding: 9px 18px;
      border-radius: 10px;
      border: none;
      background: var(--accent);
      color: white;
      font-family: 'DM Sans', sans-serif;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      box-shadow: 0 0 16px var(--glow);
      white-space: nowrap;
    }

    .btn-primary:hover {
      background: var(--accent2);
      transform: translateY(-1px);
    }

    .btn-secondary {
      padding: 9px 18px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--bg3);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      white-space: nowrap;
    }

    .btn-secondary:hover {
      border-color: rgba(255, 255, 255, 0.15);
    }

    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.75);
      backdrop-filter: blur(10px);
      z-index: 200;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
    }

    .modal-overlay.open {
      opacity: 1;
      pointer-events: all;
    }

    .modal {
      background: var(--bg2);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 22px;
      padding: 28px;
      width: 100%;
      max-width: 460px;
      transform: scale(0.94);
      transition: transform 0.2s;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-overlay.open .modal {
      transform: scale(1);
    }

    .modal-title {
      font-family: 'Bebas Neue', cursive;
      font-size: 26px;
      letter-spacing: 2px;
      margin-bottom: 22px;
    }

    .form-group {
      margin-bottom: 14px;
    }

    label {
      display: block;
      font-size: 11px;
      font-weight: 600;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 7px;
    }

    input,
    textarea,
    select {
      width: 100%;
      padding: 11px 13px;
      background: var(--bg3);
      border: 1px solid var(--border);
      border-radius: 9px;
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      font-size: 14px;
      transition: border-color 0.2s;
      outline: none;
    }

    input:focus,
    textarea:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.12);
    }

    textarea {
      resize: vertical;
      min-height: 72px;
    }

    select option {
      background: var(--bg2);
    }

    .color-picker-row {
      display: flex;
      gap: 7px;
      flex-wrap: wrap;
    }

    .color-opt {
      width: 30px;
      height: 30px;
      border-radius: 7px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: transform 0.15s, border-color 0.15s;
    }

    .color-opt:hover {
      transform: scale(1.15);
    }

    .color-opt.selected {
      border-color: white;
      transform: scale(1.1);
      box-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
    }

    .modal-actions {
      display: flex;
      gap: 8px;
      margin-top: 22px;
      justify-content: flex-end;
    }

    .cat-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 14px;
    }

    .cat-card {
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 22px;
      text-align: center;
      position: relative;
      overflow: hidden;
      transition: all 0.2s;
    }

    .cat-card:hover {
      transform: translateY(-2px);
      border-color: rgba(255, 255, 255, 0.12);
    }

    .cat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--c, var(--accent));
    }

    .cat-icon-big {
      font-size: 30px;
      margin-bottom: 10px;
    }

    .cat-name {
      font-family: 'Bebas Neue', cursive;
      font-size: 18px;
      letter-spacing: 1px;
      margin-bottom: 4px;
    }

    .cat-count {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 12px;
    }

    .cat-actions {
      display: flex;
      gap: 6px;
      justify-content: center;
    }

    .report-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 18px;
      margin-bottom: 24px;
    }

    .report-card {
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 22px;
    }

    .report-card-title {
      font-size: 12px;
      font-weight: 600;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 14px;
    }

    .report-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 7px 0;
      border-bottom: 1px solid var(--border);
      font-size: 13px;
    }

    .report-row:last-child {
      border-bottom: none;
    }

    .report-val {
      font-family: 'JetBrains Mono', monospace;
      font-weight: 600;
      color: var(--accent);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    th {
      text-align: left;
      padding: 8px 0;
      color: var(--muted);
      font-weight: 600;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      border-bottom: 1px solid var(--border);
    }

    td {
      padding: 10px 0;
      border-bottom: 1px solid var(--border);
      vertical-align: middle;
    }

    tr:last-child td {
      border-bottom: none;
    }

    .backup-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 18px;
      margin-bottom: 24px;
    }

    .backup-card {
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 28px;
      text-align: center;
    }

    .backup-icon {
      font-size: 36px;
      margin-bottom: 14px;
    }

    .backup-title {
      font-family: 'Bebas Neue', cursive;
      font-size: 20px;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }

    .backup-desc {
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 18px;
      line-height: 1.5;
    }

    .empty-state {
      text-align: center;
      padding: 50px 20px;
      color: var(--muted);
    }

    .empty-icon {
      font-size: 44px;
      margin-bottom: 14px;
    }

    .empty-title {
      font-family: 'Bebas Neue', cursive;
      font-size: 22px;
      letter-spacing: 2px;
      margin-bottom: 6px;
      color: var(--text);
    }

    .empty-desc {
      font-size: 13px;
      max-width: 280px;
      margin: 0 auto 18px;
    }

    .toast-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 300;
      display: flex;
      flex-direction: column;
      gap: 7px;
    }

    .toast {
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: 11px;
      padding: 11px 16px;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 9px;
      animation: slideIn 0.3s ease;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
      min-width: 220px;
    }

    .toast.success {
      border-color: var(--green);
    }

    .toast.error {
      border-color: var(--red);
    }

    @keyframes slideIn {
      from {
        transform: translateX(120%);
        opacity: 0
      }

      to {
        transform: translateX(0);
        opacity: 1
      }
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 9px;
      border-radius: 99px;
      font-size: 11px;
      font-weight: 600;
      background: var(--bg3);
      border: 1px solid var(--border);
      color: var(--muted);
    }

    .divider {
      height: 1px;
      background: var(--border);
      margin: 22px 0;
    }

    .filter-row {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    .filter-row select {
      width: auto;
      padding: 8px 12px;
    }

    .detail-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin: 14px 0;
    }

    .detail-item {
      background: var(--bg3);
      border-radius: 9px;
      padding: 11px;
    }

    .detail-item-label {
      font-size: 10px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 3px;
    }

    .detail-item-val {
      font-family: 'JetBrains Mono', monospace;
      font-size: 18px;
      font-weight: 600;
    }

    .motivation-text {
      font-family: 'Bebas Neue', cursive;
      font-size: 17px;
      letter-spacing: 1px;
      margin: 12px 0;
      background: linear-gradient(135deg, var(--accent), var(--cyan));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    ::-webkit-scrollbar {
      width: 5px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--bg3);
      border-radius: 99px;
    }

    .hidden {
      display: none !important;
    }

    @media(max-width:768px) {
      .charts-grid {
        grid-template-columns: 1fr;
      }

      .backup-grid {
        grid-template-columns: 1fr;
      }

      .page-title {
        font-size: 32px;
      }
    }

    @media(max-width:480px) {
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .trend-bar {
      flex: 1;
      height: 100%;
      min-width: 3px;
      border-radius: 2px;
      background: var(--accent);
      transition: height 0.3s ease;
    }

    .trend-bar:hover {
      background: var(--accent2);
      transform: scaleY(1.1);
    }
  </style>
</head>

<body>
  <nav>
    <div style="display:flex;align-items:center;gap:12px">
      <div class="logo">STRIVE</div>
      <button id="pwa-install" class="btn-primary" style="padding:6px 12px;font-size:11px;display:none;">üì≤ Install
        App</button>
    </div>
    <div class="nav-tabs-container" style="display:flex;align-items:center;gap:15px">
      <div class="nav-tabs" id="nav-tabs">
        <button class="nav-tab active" data-section="dashboard">üìä Dashboard</button>
        <button class="nav-tab" data-section="challenges">üéØ Challenges</button>
        <button class="nav-tab" data-section="categories">üè∑Ô∏è Categories</button>
        <button class="nav-tab" data-section="reports">üìà Reports</button>
        <button class="nav-tab" data-section="backup">üíæ Backup</button>
      </div>
      <button id="theme-toggle" class="btn-icon" style="width:36px;height:36px;border-radius:10px;font-size:16px"
        title="Toggle Theme">üåô</button>
    </div>
  </nav>
  <main>
    <!-- DASHBOARD -->
    <section class="section active" id="sec-dashboard">
      <div class="page-header">
        <div>
          <div class="page-title">YOUR <span>PROGRESS</span></div>
          <div class="page-sub" id="today-date"></div>
        </div>
        <button class="btn-primary" onclick="openNewChallenge()">Ôºã New Challenge</button>
      </div>
      <div class="stats-grid" id="dash-stats"></div>
      <div class="charts-grid">
        <div class="chart-card">
          <div class="chart-title">üìÖ 28-Day Activity Heatmap</div>
          <div class="heatmap" id="dash-heatmap"></div>
        </div>
        <div class="chart-card">
          <div class="chart-title">üìä Weekly Completions</div>
          <div class="bar-chart" id="dash-bar"></div>
        </div>
      </div>
      <div class="charts-grid">
        <div class="chart-card">
          <div class="chart-title">ü•ß By Category</div>
          <div class="ring-container"><svg class="ring-svg" id="ring-svg" width="110" height="110"
              viewBox="0 0 110 110"></svg>
            <div class="ring-legend" id="ring-legend"></div>
          </div>
        </div>
        <div class="chart-card">
          <div class="chart-title">üî• Top Streaks</div>
          <div id="top-streaks"></div>
        </div>
      </div>
      <div style="margin-top:28px">
        <div class="page-header" style="margin-bottom:18px">
          <div class="page-title" style="font-size:28px">ACTIVE <span>TODAY</span></div>
        </div>
        <div class="challenges-grid" id="active-today"></div>
      </div>
    </section>
    <!-- CHALLENGES -->
    <section class="section" id="sec-challenges">
      <div class="page-header">
        <div class="page-title">ALL <span>CHALLENGES</span></div>
        <div class="filter-row">
          <select id="filter-cat" onchange="renderChallenges()">
            <option value="">All Categories</option>
          </select>
          <select id="filter-status" onchange="renderChallenges()">
            <option value="">All Status</option>
            <option value="active">Active</option>
            <option value="completed">Completed</option>
            <option value="pending">Pending</option>
          </select>
          <button class="btn-primary" onclick="openNewChallenge()">Ôºã New</button>
        </div>
      </div>
      <div class="challenges-grid" id="all-challenges"></div>
    </section>
    <!-- CATEGORIES -->
    <section class="section" id="sec-categories">
      <div class="page-header">
        <div class="page-title">CATE<span>GORIES</span></div><button class="btn-primary" onclick="openNewCategory()">Ôºã
          New Category</button>
      </div>
      <div class="cat-grid" id="cat-grid"></div>
    </section>
    <!-- REPORTS -->
    <section class="section" id="sec-reports">
      <div class="page-header">
        <div class="page-title">REPOR<span>TS</span></div>
      </div>
      <div class="report-grid" id="report-grid"></div>
      <div class="chart-card" style="margin-bottom:18px">
        <div class="chart-title">üìÜ 30-Day Completion Calendar</div>
        <div id="report-calendar" style="display:grid;grid-template-columns:repeat(30,1fr);gap:2px;margin-top:8px;">
        </div>
      </div>
      <div class="chart-card">
        <div class="chart-title">üìã Performance Table</div>
        <div id="perf-table" style="overflow-x:auto;margin-top:8px;"></div>
      </div>
    </section>
    <!-- BACKUP -->
    <section class="section" id="sec-backup">
      <div class="page-header">
        <div class="page-title">BACK<span>UP</span></div>
      </div>
      <div class="backup-grid">
        <div class="backup-card">
          <div class="backup-icon">üì§</div>
          <div class="backup-title">Export Backup</div>
          <div class="backup-desc">Download all your data as a JSON file. Keep it safe!</div><button class="btn-primary"
            style="width:100%;justify-content:center" onclick="exportBackup()">‚¨áÔ∏è Download JSON</button>
        </div>
        <div class="backup-card">
          <div class="backup-icon">üì•</div>
          <div class="backup-title">Restore Backup</div>
          <div class="backup-desc">Restore from a previously exported JSON backup file.</div><input type="file"
            id="restore-input" accept=".json" class="hidden" onchange="importBackup(event)"><button
            class="btn-secondary" style="width:100%;justify-content:center"
            onclick="document.getElementById('restore-input').click()">‚¨ÜÔ∏è Upload Backup</button>
        </div>
      </div>
      <div class="divider"></div>
      <div class="report-card">
        <div class="report-card-title">‚ö†Ô∏è Danger Zone</div>
        <p style="font-size:13px;color:var(--muted);margin-bottom:16px">These actions cannot be undone. Export a backup
          first!</p>
        <div style="display:flex;gap:10px;flex-wrap:wrap"><button class="btn-secondary"
            style="border-color:var(--red);color:var(--red)" onclick="clearChallenges()">Clear All
            Challenges</button><button class="btn-secondary" style="border-color:var(--red);color:var(--red)"
            onclick="clearAll()">‚ö†Ô∏è Reset Everything</button></div>
      </div>
    </section>
  </main>

  <!-- CHALLENGE MODAL -->
  <div class="modal-overlay" id="modal-challenge">
    <div class="modal">
      <div class="modal-title" id="modal-ch-title">NEW CHALLENGE</div>
      <div class="form-group"><label>Name *</label><input type="text" id="ch-name" placeholder="e.g. Daily Meditation"
          maxlength="60"></div>
      <div class="form-group"><label>Description</label><textarea id="ch-desc"
          placeholder="What will you do each day?"></textarea></div>
      <div class="form-group"><label>Category</label><select id="ch-cat">
          <option value="">‚Äî No Category ‚Äî</option>
        </select></div>
      <div class="form-group"><label>Duration (days)</label><input type="number" id="ch-days" value="30" min="1"
          max="365"></div>
      <div class="form-group"><label>Start Date</label><input type="date" id="ch-start"></div>
      <div class="form-group"><label>Color</label>
        <div class="color-picker-row" id="ch-colors">
          <div class="color-opt selected" style="background:#6366f1" data-color="#6366f1"></div>
          <div class="color-opt" style="background:#06b6d4" data-color="#06b6d4"></div>
          <div class="color-opt" style="background:#10b981" data-color="#10b981"></div>
          <div class="color-opt" style="background:#f59e0b" data-color="#f59e0b"></div>
          <div class="color-opt" style="background:#ef4444" data-color="#ef4444"></div>
          <div class="color-opt" style="background:#ec4899" data-color="#ec4899"></div>
          <div class="color-opt" style="background:#f97316" data-color="#f97316"></div>
          <div class="color-opt" style="background:#8b5cf6" data-color="#8b5cf6"></div>
        </div>
      </div>
      <div class="modal-actions"><button class="btn-secondary"
          onclick="closeModal('modal-challenge')">Cancel</button><button class="btn-primary"
          onclick="saveChallenge()">Save Challenge</button></div>
    </div>
  </div>

  <!-- CATEGORY MODAL -->
  <div class="modal-overlay" id="modal-category">
    <div class="modal">
      <div class="modal-title">NEW CATEGORY</div>
      <div class="form-group"><label>Name *</label><input type="text" id="cat-name" placeholder="e.g. Fitness, Reading"
          maxlength="30"></div>
      <div class="form-group"><label>Icon (emoji)</label><input type="text" id="cat-icon" placeholder="üéØ"
          maxlength="2"></div>
      <div class="form-group"><label>Color</label>
        <div class="color-picker-row" id="cat-colors">
          <div class="color-opt selected" style="background:#6366f1" data-color="#6366f1"></div>
          <div class="color-opt" style="background:#06b6d4" data-color="#06b6d4"></div>
          <div class="color-opt" style="background:#10b981" data-color="#10b981"></div>
          <div class="color-opt" style="background:#f59e0b" data-color="#f59e0b"></div>
          <div class="color-opt" style="background:#ef4444" data-color="#ef4444"></div>
          <div class="color-opt" style="background:#ec4899" data-color="#ec4899"></div>
          <div class="color-opt" style="background:#f97316" data-color="#f97316"></div>
          <div class="color-opt" style="background:#8b5cf6" data-color="#8b5cf6"></div>
        </div>
      </div>
      <div class="modal-actions"><button class="btn-secondary"
          onclick="closeModal('modal-category')">Cancel</button><button class="btn-primary"
          onclick="saveCategory()">Save Category</button></div>
    </div>
  </div>

  <!-- DETAIL MODAL -->
  <div class="modal-overlay" id="modal-detail">
    <div class="modal" style="max-width:520px">
      <div id="detail-body"></div>
      <div class="modal-actions"><button class="btn-secondary" onclick="closeModal('modal-detail')">Close</button></div>
    </div>
  </div>

  <div class="toast-container" id="toasts"></div>

  <script>
    const KEYS = { ch: 'strive_challenges', cat: 'strive_categories' };
    const load = k => { try { return JSON.parse(localStorage.getItem(k) || '[]'); } catch { return []; } };
    const save = (k, v) => localStorage.setItem(k, JSON.stringify(v));
    const uid = () => Date.now().toString(36) + Math.random().toString(36).slice(2, 7);
    const today = () => new Date().toISOString().split('T')[0];
    const daysBetween = (a, b) => Math.floor((new Date(b) - new Date(a)) / 86400000);
    const h2r = (hex, a) => { const [r, g, b] = [1, 3, 5].map(i => parseInt(hex.slice(i, i + 2), 16)); return `rgba(${r},${g},${b},${a})`; };
    const fmtDate = d => new Date(d + 'T00:00:00').toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });

    function toast(msg, type = 'success') {
      const el = document.createElement('div');
      el.className = `toast ${type}`;
      el.innerHTML = `<span>${type === 'success' ? '‚úÖ' : '‚ùå'}</span><span>${msg}</span>`;
      document.getElementById('toasts').appendChild(el);
      setTimeout(() => el.remove(), 3200);
    }

    function currentDay(ch) {
      const t = today();
      if (t < ch.startDate) return 0;
      return Math.min(daysBetween(ch.startDate, t) + 1, ch.duration);
    }
    function todayDone(ch) { return (ch.completedDates || []).includes(today()); }
    function streak(ch) {
      const dates = [...(ch.completedDates || [])].sort().reverse();
      if (!dates.length) return 0;
      let s = 0, check = today();
      for (let i = 0; i < 365; i++) {
        if (dates.includes(check)) { s++; const d = new Date(check + 'T00:00:00'); d.setDate(d.getDate() - 1); check = d.toISOString().split('T')[0]; }
        else break;
      }
      return s;
    }
    function compRate(ch) { const e = Math.min(currentDay(ch), ch.duration); return e ? Math.round(((ch.completedDates || []).length / e) * 100) : 0; }
    function isComplete(ch) { return (ch.completedDates || []).length >= ch.duration; }

    function toggleDay(id, dateStr) {
      const chs = load(KEYS.ch);
      const ch = chs.find(c => c.id === id);
      if (!ch) return;
      if (!ch.completedDates) ch.completedDates = [];
      if (ch.completedDates.includes(dateStr)) { ch.completedDates = ch.completedDates.filter(d => d !== dateStr); toast('Day unchecked', 'error'); }
      else { ch.completedDates.push(dateStr); const s = streak(ch); toast(s > 1 ? `üî• ${s}-day streak!` : '‚úÖ Day logged!'); }
      save(KEYS.ch, chs);
      renderCurrent();
    }

    let currentSection = 'dashboard';
    document.getElementById('nav-tabs').addEventListener('click', e => {
      const tab = e.target.closest('.nav-tab');
      if (!tab) return;
      const sec = tab.dataset.section;
      document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById('sec-' + sec).classList.add('active');
      currentSection = sec;
      renderCurrent();
    });

    function renderCurrent() { ({ dashboard: renderDashboard, challenges: renderChallenges, categories: renderCategories, reports: renderReports }[currentSection] || function () { })(); }

    let editId = null, selColor = '#6366f1', selCatColor = '#6366f1';

    function openModal(id) { document.getElementById(id).classList.add('open'); }
    function closeModal(id) { document.getElementById(id).classList.remove('open'); }
    document.querySelectorAll('.modal-overlay').forEach(m => m.addEventListener('click', e => { if (e.target === m) m.classList.remove('open'); }));

    document.getElementById('ch-colors').addEventListener('click', e => { const o = e.target.closest('.color-opt'); if (!o) return; document.querySelectorAll('#ch-colors .color-opt').forEach(x => x.classList.remove('selected')); o.classList.add('selected'); selColor = o.dataset.color; });
    document.getElementById('cat-colors').addEventListener('click', e => { const o = e.target.closest('.color-opt'); if (!o) return; document.querySelectorAll('#cat-colors .color-opt').forEach(x => x.classList.remove('selected')); o.classList.add('selected'); selCatColor = o.dataset.color; });

    function populateCatSelect(sel = '') {
      const cats = load(KEYS.cat);
      const el = document.getElementById('ch-cat');
      el.innerHTML = '<option value="">‚Äî No Category ‚Äî</option>';
      cats.forEach(c => { const o = document.createElement('option'); o.value = c.id; o.textContent = `${c.icon} ${c.name}`; if (c.id === sel) o.selected = true; el.appendChild(o); });
    }

    function openNewChallenge() {
      editId = null;
      document.getElementById('modal-ch-title').textContent = 'NEW CHALLENGE';
      document.getElementById('ch-name').value = '';
      document.getElementById('ch-desc').value = '';
      document.getElementById('ch-days').value = 30;
      document.getElementById('ch-start').value = today();
      selColor = '#6366f1';
      document.querySelectorAll('#ch-colors .color-opt').forEach((o, i) => o.classList.toggle('selected', i === 0));
      populateCatSelect();
      openModal('modal-challenge');
    }

    function openEditChallenge(id) {
      const ch = load(KEYS.ch).find(c => c.id === id); if (!ch) return;
      editId = id;
      document.getElementById('modal-ch-title').textContent = 'EDIT CHALLENGE';
      document.getElementById('ch-name').value = ch.name;
      document.getElementById('ch-desc').value = ch.description || '';
      document.getElementById('ch-days').value = ch.duration;
      document.getElementById('ch-start').value = ch.startDate;
      selColor = ch.color || '#6366f1';
      document.querySelectorAll('#ch-colors .color-opt').forEach(o => o.classList.toggle('selected', o.dataset.color === ch.color));
      populateCatSelect(ch.categoryId);
      openModal('modal-challenge');
    }

    function saveChallenge() {
      const name = document.getElementById('ch-name').value.trim();
      if (!name) { toast('Name is required', 'error'); return; }
      const chs = load(KEYS.ch);
      const data = { name, description: document.getElementById('ch-desc').value.trim(), categoryId: document.getElementById('ch-cat').value, duration: parseInt(document.getElementById('ch-days').value) || 30, startDate: document.getElementById('ch-start').value || today(), color: selColor };
      if (editId) { const i = chs.findIndex(c => c.id === editId); if (i >= 0) chs[i] = { ...chs[i], ...data }; }
      else chs.push({ id: uid(), ...data, completedDates: [], createdAt: new Date().toISOString() });
      save(KEYS.ch, chs);
      closeModal('modal-challenge');
      toast(editId ? 'Challenge updated!' : 'üöÄ Challenge created!');
      renderCurrent();
    }

    function openNewCategory() {
      document.getElementById('cat-name').value = '';
      document.getElementById('cat-icon').value = '';
      selCatColor = '#6366f1';
      document.querySelectorAll('#cat-colors .color-opt').forEach((o, i) => o.classList.toggle('selected', i === 0));
      openModal('modal-category');
    }

    function saveCategory() {
      const name = document.getElementById('cat-name').value.trim();
      if (!name) { toast('Name is required', 'error'); return; }
      const cats = load(KEYS.cat);
      cats.push({ id: uid(), name, icon: document.getElementById('cat-icon').value.trim() || 'üìå', color: selCatColor, createdAt: new Date().toISOString() });
      save(KEYS.cat, cats);
      closeModal('modal-category');
      toast('Category created!');
      renderCurrent();
    }

    function deleteChallenge(id) { if (!confirm('Delete this challenge? All progress will be lost.')) return; save(KEYS.ch, load(KEYS.ch).filter(c => c.id !== id)); toast('Deleted', 'error'); renderCurrent(); }
    function deleteCategory(id) { if (!confirm('Delete this category?')) return; save(KEYS.cat, load(KEYS.cat).filter(c => c.id !== id)); toast('Category deleted', 'error'); renderCurrent(); }

    function openDetail(id) {
      const chs = load(KEYS.ch), cats = load(KEYS.cat);
      const ch = chs.find(c => c.id === id); if (!ch) return;
      const cat = cats.find(c => c.id === ch.categoryId);
      const day = currentDay(ch), rate = compRate(ch), s = streak(ch);
      const motives = ["You're crushing it! üí™", "Keep going, legend! üî•", "Every day counts! ‚ö°", "Unstoppable! üöÄ", "Building greatness! üèÜ"];
      const dots = Array.from({ length: ch.duration }, (_, i) => {
        const d = new Date(ch.startDate + 'T00:00:00'); d.setDate(d.getDate() + i);
        const ds = d.toISOString().split('T')[0];
        const comp = (ch.completedDates || []).includes(ds);
        return `<div class="day-dot${comp ? ' completed' : ''}" style="${comp ? `background:${h2r(ch.color, .8)};border-color:${ch.color};color:white` : ''}" title="Day ${i + 1}: ${fmtDate(ds)}">${comp ? '‚úì' : i + 1}</div>`;
      }).join('');
      document.getElementById('detail-body').innerHTML = `
    <div class="modal-title" style="color:${ch.color}">${ch.name}</div>
    ${ch.description ? `<p style="font-size:13px;color:var(--muted);margin-bottom:12px">${ch.description}</p>` : ''}
    ${cat ? `<span class="cat-badge" style="background:${h2r(cat.color, .15)};color:${cat.color}">${cat.icon} ${cat.name}</span>` : ''}
    <div class="detail-grid">
      <div class="detail-item"><div class="detail-item-label">Day</div><div class="detail-item-val" style="color:${ch.color}">${day}/${ch.duration}</div></div>
      <div class="detail-item"><div class="detail-item-label">Rate</div><div class="detail-item-val" style="color:${rate >= 80 ? 'var(--green)' : rate >= 50 ? 'var(--yellow)' : 'var(--red)'}">${rate}%</div></div>
      <div class="detail-item"><div class="detail-item-label">Streak</div><div class="detail-item-val">üî• ${s}d</div></div>
      <div class="detail-item"><div class="detail-item-label">Logged</div><div class="detail-item-val">${(ch.completedDates || []).length}d</div></div>
    </div>
    <div class="motivation-text">${motives[Math.floor(Math.random() * motives.length)]}</div>
    <div style="font-size:12px;color:var(--muted);margin-bottom:8px">Started: ${fmtDate(ch.startDate)}</div>
    <div class="progress-bar" style="margin-bottom:12px"><div class="progress-fill" style="width:${Math.round(day / ch.duration * 100)}%;background:linear-gradient(90deg,${ch.color},${ch.color}99)"></div></div>
    <div class="day-dots">${dots}</div>`;
      openModal('modal-detail');
    }

    function challengeCard(ch, cats) {
      const cat = cats.find(c => c.id === ch.categoryId);
      const day = currentDay(ch), pct = Math.round(day / ch.duration * 100), tdDone = todayDone(ch), s = streak(ch), done = isComplete(ch);
      const dots = Array.from({ length: ch.duration }, (_, i) => {
        const d = new Date(ch.startDate + 'T00:00:00'); d.setDate(d.getDate() + i);
        const ds = d.toISOString().split('T')[0];
        const comp = (ch.completedDates || []).includes(ds);
        return `<div class="day-dot${comp ? ' completed' : ''}" style="${comp ? `background:${h2r(ch.color, .8)};border-color:${ch.color};color:white` : ''}" title="Day ${i + 1}" onclick="event.stopPropagation();toggleDay('${ch.id}','${ds}')">${comp ? '‚úì' : i + 1}</div>`;
      }).join('');
      let btnClass = 'btn-check', btnTxt = '‚òê Mark Today', btnDis = false;
      if (done) { btnClass += ' challenge-complete'; btnTxt = 'üèÜ COMPLETED!'; btnDis = true; }
      else if (tdDone) { btnClass += ' done-today'; btnTxt = '‚úÖ Done Today!'; btnDis = true; }
      return `<div class="challenge-card">
    <div class="challenge-card-accent" style="background:linear-gradient(90deg,${ch.color},${ch.color}66)"></div>
    <div class="challenge-card-header">
      ${cat ? `<span class="cat-badge" style="background:${h2r(cat.color, .15)};color:${cat.color}">${cat.icon} ${cat.name}</span>` : '<span></span>'}
      <div class="card-actions">
        <button class="btn-icon" title="Details" onclick="openDetail('${ch.id}')">üëÅ</button>
        <button class="btn-icon" title="Edit" onclick="openEditChallenge('${ch.id}')">‚úèÔ∏è</button>
        <button class="btn-icon danger" title="Delete" onclick="deleteChallenge('${ch.id}')">üóë</button>
      </div>
    </div>
    <div class="challenge-name">${ch.name}</div>
    ${ch.description ? `<div class="challenge-desc">${ch.description}</div>` : ''}
    <div class="progress-meta"><span class="progress-day">Day ${day} / ${ch.duration}</span><span>${pct}%</span></div>
    <div class="progress-bar"><div class="progress-fill" style="width:${pct}%;background:linear-gradient(90deg,${ch.color},${ch.color}88)"></div></div>
    <div class="day-dots">${dots}</div>
    <div class="card-footer">
      <button class="${btnClass}" ${btnDis ? 'disabled' : ''} onclick="toggleDay('${ch.id}','${today()}')">${btnTxt}</button>
      <div class="streak-badge">${s > 0 ? 'üî•' : 'üí§'} ${s}d</div>
    </div>
  </div>`;
    }

    function empty(icon, title, desc, btn, fn) {
      return `<div class="empty-state" style="grid-column:1/-1">
    <div class="empty-icon">${icon}</div><div class="empty-title">${title}</div>
    <div class="empty-desc">${desc}</div>
    ${btn ? `<button class="btn-primary" style="margin:0 auto" onclick="${fn}">${btn}</button>` : ''}
  </div>`;
    }

    function renderDashboard() {
      document.getElementById('today-date').textContent = new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
      const chs = load(KEYS.ch), cats = load(KEYS.cat);
      const active = chs.filter(c => !isComplete(c) && currentDay(c) > 0);
      const done = chs.filter(isComplete);
      const maxStr = chs.length ? Math.max(...chs.map(streak)) : 0;
      const avgRate = chs.length ? Math.round(chs.reduce((a, c) => a + compRate(c), 0) / chs.length) : 0;

      document.getElementById('dash-stats').innerHTML = [
        { icon: 'üéØ', label: 'Total', value: chs.length, color: '#6366f1' },
        { icon: '‚ö°', label: 'Active', value: active.length, color: '#06b6d4' },
        { icon: '‚úÖ', label: 'Today', value: chs.filter(todayDone).length, color: '#10b981' },
        { icon: 'üèÜ', label: 'Done', value: done.length, color: '#f59e0b' },
        { icon: 'üî•', label: 'Best Streak', value: maxStr + 'd', color: '#ef4444' },
        { icon: 'üìà', label: 'Avg Rate', value: avgRate + '%', color: '#8b5cf6' },
      ].map(s => `<div class="stat-card" style="--card-color:${s.color}"><div class="stat-icon">${s.icon}</div><div class="stat-value">${s.value}</div><div class="stat-label">${s.label}</div></div>`).join('');

      const hm = document.getElementById('dash-heatmap'); hm.innerHTML = '';
      for (let i = 27; i >= 0; i--) {
        const d = new Date(); d.setDate(d.getDate() - i);
        const ds = d.toISOString().split('T')[0];
        const cnt = chs.filter(c => (c.completedDates || []).includes(ds)).length;
        const level = !cnt ? 0 : cnt === 1 ? 1 : cnt <= 3 ? 2 : cnt <= 5 ? 3 : 4;
        const cell = document.createElement('div');
        cell.className = 'heatmap-cell'; cell.dataset.level = level; cell.title = `${fmtDate(ds)}: ${cnt}`;
        hm.appendChild(cell);
      }

      const bc = document.getElementById('dash-bar');
      const labels = ['8w', '7w', '6w', '5w', '4w', '3w', '2w', 'Now'];
      const counts = labels.map((_, wi) => {
        let cnt = 0;
        for (let d = 0; d < 7; d++) { const off = (7 - wi) * 7 - d, dt = new Date(); dt.setDate(dt.getDate() - off); cnt += chs.filter(c => (c.completedDates || []).includes(dt.toISOString().split('T')[0])).length; }
        return cnt;
      });
      const maxC = Math.max(...counts, 1);
      bc.innerHTML = labels.map((l, i) => `<div class="bar-wrap"><div class="bar" style="height:${(counts[i] / maxC) * 100}%" title="${counts[i]}"></div><div class="bar-label">${l}</div></div>`).join('');

      // Ring
      const svg = document.getElementById('ring-svg'), leg = document.getElementById('ring-legend');
      const cx = 55, cy = 55, r = 40, sw = 13, circ = 2 * Math.PI * r;
      if (!chs.length) { svg.innerHTML = `<circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="var(--bg3)" stroke-width="${sw}"/>`; leg.innerHTML = '<div style="color:var(--muted);font-size:12px">No data</div>'; }
      else {
        const groups = {};
        chs.forEach(ch => { const k = ch.categoryId || '_none'; if (!groups[k]) groups[k] = { count: 0, color: ch.color }; groups[k].count++; });
        const total = chs.length;
        const items = Object.entries(groups).map(([k, v]) => { const cat = cats.find(c => c.id === k); return { name: cat ? `${cat.icon} ${cat.name}` : 'üìå None', count: v.count, color: cat ? cat.color : v.color }; });
        let offset = 0, content = `<circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="var(--bg3)" stroke-width="${sw}"/>`;
        items.forEach(item => { const dl = (item.count / total) * circ; content += `<circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="${item.color}" stroke-width="${sw}" stroke-dasharray="${dl} ${circ - dl}" stroke-dashoffset="${-offset}" transform="rotate(-90 ${cx} ${cy})"/>`; offset += dl; });
        svg.innerHTML = content;
        leg.innerHTML = items.map(item => `<div class="ring-item"><div class="ring-dot" style="background:${item.color}"></div><span>${item.name}</span><span class="ring-pct">${item.count}</span></div>`).join('');
      }

      // Top streaks
      const ts = [...chs].sort((a, b) => streak(b) - streak(a)).slice(0, 5);
      document.getElementById('top-streaks').innerHTML = ts.length
        ? ts.map(ch => `<div class="report-row"><span>${ch.name}</span><span class="report-val" style="color:${ch.color}">${streak(ch) > 0 ? 'üî•' : 'üí§'} ${streak(ch)}d</span></div>`).join('')
        : '<div style="color:var(--muted);font-size:13px;text-align:center;padding:20px">No challenges yet</div>';

      const at = document.getElementById('active-today');
      const todayActive = chs.filter(c => currentDay(c) > 0 && !isComplete(c));
      at.innerHTML = todayActive.length ? todayActive.map(ch => challengeCard(ch, cats)).join('') : empty('üöÄ', 'NO ACTIVE CHALLENGES', 'Create your first challenge and start building habits!', 'Ôºã Start Now', 'openNewChallenge()');
    }

    function renderChallenges() {
      const chs = load(KEYS.ch), cats = load(KEYS.cat);
      const fc = document.getElementById('filter-cat'), fv = fc.value;
      fc.innerHTML = '<option value="">All Categories</option>';
      cats.forEach(c => { const o = document.createElement('option'); o.value = c.id; o.textContent = `${c.icon} ${c.name}`; if (c.id === fv) o.selected = true; fc.appendChild(o); });
      const catF = document.getElementById('filter-cat').value, stF = document.getElementById('filter-status').value;
      let list = chs;
      if (catF) list = list.filter(c => c.categoryId === catF);
      if (stF === 'active') list = list.filter(c => !isComplete(c) && currentDay(c) > 0);
      if (stF === 'completed') list = list.filter(isComplete);
      if (stF === 'pending') list = list.filter(c => currentDay(c) === 0);
      document.getElementById('all-challenges').innerHTML = list.length ? list.map(ch => challengeCard(ch, cats)).join('') : empty('üéØ', 'NO CHALLENGES FOUND', 'Try a different filter or create a new challenge', 'Ôºã Create', 'openNewChallenge()');
    }

    function renderCategories() {
      const chs = load(KEYS.ch), cats = load(KEYS.cat);
      document.getElementById('cat-grid').innerHTML = cats.length
        ? cats.map(cat => { const cnt = chs.filter(c => c.categoryId === cat.id).length; return `<div class="cat-card" style="--c:${cat.color}"><div class="cat-icon-big">${cat.icon}</div><div class="cat-name" style="color:${cat.color}">${cat.name}</div><div class="cat-count">${cnt} challenge${cnt !== 1 ? 's' : ''}</div><div class="cat-actions"><button class="btn-icon danger" onclick="deleteCategory('${cat.id}')">üóë</button></div></div>`; }).join('')
        : empty('üè∑Ô∏è', 'NO CATEGORIES', 'Create categories to organize your challenges', 'Ôºã Add Category', 'openNewCategory()');
    }

    function getWeekdayStats(chs) {
      const stats = [0, 0, 0, 0, 0, 0, 0];
      chs.forEach(ch => {
        (ch.completedDates || []).forEach(d => {
          const day = new Date(d + 'T00:00:00').getDay();
          stats[day]++;
        });
      });
      return stats;
    }

    function getProductivityScore(chs) {
      if (!chs.length) return 0;
      const totalPossible = chs.reduce((a, c) => a + c.duration, 0);
      const totalDone = chs.reduce((a, c) => a + (c.completedDates || []).length, 0);
      return Math.round((totalDone / totalPossible) * 100);
    }

    function getTrendData(chs) {
      const trend = [];
      for (let i = 29; i >= 0; i--) {
        const d = new Date(); d.setDate(d.getDate() - i);
        const ds = d.toISOString().split('T')[0];
        const count = chs.filter(c => (c.completedDates || []).includes(ds)).length;
        trend.push({ date: ds, count });
      }
      return trend;
    }

    function getCategoryLeaderboard(chs, cats) {
      const stats = cats.map(cat => {
        const catChs = chs.filter(c => c.categoryId === cat.id);
        if (!catChs.length) return null;
        const avgRate = Math.round(catChs.reduce((a, c) => a + compRate(c), 0) / catChs.length);
        return { name: `${cat.icon} ${cat.name}`, rate: avgRate, color: cat.color };
      }).filter(Boolean);
      return stats.sort((a, b) => b.rate - a.rate);
    }

    function checkMilestones(chs) {
      const milestones = [];
      const totalLogs = chs.reduce((a, c) => a + (c.completedDates || []).length, 0);
      const done = chs.filter(isComplete).length;
      const maxStreak = chs.length ? Math.max(...chs.map(streak)) : 0;

      if (maxStreak >= 7) milestones.push({ icon: 'üî•', label: 'Week Warrior', desc: 'Achieved a 7-day streak' });
      if (maxStreak >= 30) milestones.push({ icon: 'üëë', label: 'Monthly Master', desc: 'Achieved a 30-day streak' });
      if (totalLogs >= 100) milestones.push({ icon: 'üíØ', label: 'Century Logger', desc: 'Logged 100 total days' });
      if (done >= 1) milestones.push({ icon: 'üèÜ', label: 'First Finish', desc: 'Completed your first challenge' });
      if (done >= 5) milestones.push({ icon: 'üèÖ', label: 'High Achiever', desc: 'Completed 5 challenges' });
      if (chs.length >= 10) milestones.push({ icon: 'üìÇ', label: 'Habit Builder', desc: 'Created 10 challenges' });

      return milestones;
    }

    function renderReports() {
      const chs = load(KEYS.ch), cats = load(KEYS.cat);
      const totalLogged = chs.reduce((a, c) => a + (c.completedDates || []).length, 0);
      const avgRate = chs.length ? Math.round(chs.reduce((a, c) => a + compRate(c), 0) / chs.length) : 0;
      const maxStr = chs.length ? Math.max(...chs.map(streak)) : 0;
      const done = chs.filter(isComplete).length;
      const pScore = getProductivityScore(chs);
      const wkStats = getWeekdayStats(chs);
      const wkLabels = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      const maxWk = Math.max(...wkStats, 1);
      const milestones = checkMilestones(chs);
      const leaderboard = getCategoryLeaderboard(chs, cats);
      const trend = getTrendData(chs);
      const maxTrend = Math.max(...trend.map(t => t.count), 1);

      document.getElementById('report-grid').innerHTML = `
    <div class="report-card"><div class="report-card-title">üìä Essential Stats</div>
      <div class="report-row"><span>Total Challenges</span><span class="report-val">${chs.length}</span></div>
      <div class="report-row"><span>Productivity Score</span><span class="report-val" style="color:var(--accent)">${pScore}%</span></div>
      <div class="report-row"><span>Best Streak</span><span class="report-val">üî• ${maxStr}d</span></div>
      <div class="report-row"><span>Completed</span><span class="report-val" style="color:var(--green)">${done}</span></div></div>
    <div class="report-card"><div class="report-card-title">üìà 30-Day Activity Trend</div>
      <div class="bar-chart" style="height:80px;margin-top:10px;gap:2px">
        ${trend.map(t => `<div class="bar" style="flex:1;height:${(t.count / maxTrend) * 100}%;min-width:3px;border-radius:2px" title="${fmtDate(t.date)}: ${t.count}"></div>`).join('')}
      </div></div>
    <div class="report-card"><div class="report-card-title">üìÖ Weekday Distribution</div>
      <div class="bar-chart" style="height:80px;margin-top:10px">
        ${wkStats.map((s, i) => `<div class="bar-wrap"><div class="bar" style="height:${(s / maxWk) * 100}%;background:var(--accent2)" title="${s}"></div><div class="bar-label">${wkLabels[i]}</div></div>`).join('')}
      </div></div>`;

      let reportExtras = `<div class="report-grid">
      <div class="report-card"><div class="report-card-title">üéñÔ∏è Milestones & Badges</div>
        ${milestones.length ? `<div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:10px">
          ${milestones.map(m => `<div class="pill" style="padding:6px 12px;font-size:12px;background:var(--bg3);border-color:var(--accent);color:var(--text)" title="${m.desc}">${m.icon} ${m.label}</div>`).join('')}
        </div>` : `<div style="color:var(--muted);font-size:12px;margin-top:10px">Start logging more to unlock milestones!</div>`}
      </div>
      <div class="report-card"><div class="report-card-title">üèÜ Top Categories</div>
        ${leaderboard.length ? leaderboard.map(l => `<div class="report-row"><span>${l.name}</span><span class="report-val" style="color:${l.color}">${l.rate}%</span></div>`).join('') : `<div style="color:var(--muted);font-size:12px;margin-top:10px">No category data yet</div>`}
      </div>
      <div class="report-card"><div class="report-card-title">üí° Habit Insights</div>
        <div style="font-size:13px;line-height:1.6;margin-top:10px">
          ${totalLogged > 50 ? `‚ú® You've reached <b>${totalLogged}</b> logs! Keep up the incredible consistency.` : `üöÄ Aim for a <b>7-day streak</b> to build initial momentum.`}<br>
          ${maxStr > 0 ? `üî• Current best streak: <b>${maxStr} days</b> across all habits.` : ``}
          ${leaderboard.length ? `<br>‚≠ê Your best category is <b>${leaderboard[0].name}</b> at ${leaderboard[0].rate}% completion.` : ``}
        </div>
      </div>
    </div>`;

      const originalReportsGrid = document.getElementById('report-grid');
      const extraContainer = document.getElementById('report-extras') || document.createElement('div');
      extraContainer.id = 'report-extras';
      extraContainer.innerHTML = reportExtras;
      if (!document.getElementById('report-extras')) originalReportsGrid.after(extraContainer);

      const cal = document.getElementById('report-calendar'); cal.innerHTML = '';
      for (let i = 29; i >= 0; i--) { const d = new Date(); d.setDate(d.getDate() - i); const ds = d.toISOString().split('T')[0]; const cnt = chs.filter(c => (c.completedDates || []).includes(ds)).length; const level = !cnt ? 0 : cnt === 1 ? 1 : cnt <= 3 ? 2 : cnt <= 5 ? 3 : 4; const cell = document.createElement('div'); cell.className = 'heatmap-cell'; cell.dataset.level = level; cell.title = `${fmtDate(ds)}: ${cnt}`; cal.appendChild(cell); }
      const pt = document.getElementById('perf-table');
      if (!chs.length) { pt.innerHTML = '<div style="color:var(--muted);padding:16px;font-size:13px">No challenges yet</div>'; return; }
      pt.innerHTML = `<table><thead><tr><th>Challenge</th><th style="text-align:center">Progress</th><th style="text-align:center">Rate</th><th style="text-align:center">Streak</th><th style="text-align:center">Status</th></tr></thead><tbody>${chs.map(ch => {
        const cat = cats.find(c => c.id === ch.categoryId), day = currentDay(ch), rate = compRate(ch), s = streak(ch), done = isComplete(ch);
        return `<tr><td><div style="display:flex;align-items:center;gap:8px"><div style="width:7px;height:7px;border-radius:50%;background:${ch.color};flex-shrink:0"></div><div><div style="font-weight:500">${ch.name}</div>${cat ? `<div style="font-size:11px;color:var(--muted)">${cat.icon} ${cat.name}</div>` : ''}</div></div></td><td style="text-align:center;font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--accent)">${day}/${ch.duration}</td><td style="text-align:center"><span style="font-family:'JetBrains Mono',monospace;font-size:12px;color:${rate >= 80 ? 'var(--green)' : rate >= 50 ? 'var(--yellow)' : 'var(--red)'}">${rate}%</span></td><td style="text-align:center;font-family:'JetBrains Mono',monospace;font-size:12px">${s > 0 ? 'üî•' : 'üí§'} ${s}</td><td style="text-align:center"><span class="pill" style="${done ? 'background:rgba(16,185,129,.1);color:var(--green);border-color:var(--green)' : day > 0 ? 'background:rgba(99,102,241,.1);color:var(--accent);border-color:var(--accent)' : ''}">${done ? '‚úÖ Done' : day > 0 ? '‚ö° Active' : '‚è≥ Pending'}</span></td></tr>`;
      }).join('')}</tbody></table>`;
    }

    function exportBackup() {
      const blob = new Blob([JSON.stringify({ version: '1.0', exportedAt: new Date().toISOString(), challenges: load(KEYS.ch), categories: load(KEYS.cat) }, null, 2)], { type: 'application/json' });
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `strive-backup-${today()}.json`; a.click(); toast('Backup downloaded!');
    }

    function importBackup(e) {
      const file = e.target.files[0]; if (!file) return;
      const reader = new FileReader();
      reader.onload = ev => { try { const data = JSON.parse(ev.target.result); if (!data.challenges || !data.categories) throw new Error(); if (!confirm(`Restore ${data.challenges.length} challenges and ${data.categories.length} categories? Current data will be replaced.`)) return; save(KEYS.ch, data.challenges); save(KEYS.cat, data.categories); toast('Data restored!'); renderCurrent(); } catch { toast('Invalid backup file', 'error'); } };
      reader.readAsText(file); e.target.value = '';
    }

    function clearChallenges() { if (!confirm('Delete ALL challenges?')) return; save(KEYS.ch, []); toast('All challenges cleared', 'error'); }
    function clearAll() { if (!confirm('‚ö†Ô∏è Reset everything? Cannot be undone!')) return; save(KEYS.ch, []); save(KEYS.cat, []); toast('Everything reset', 'error'); }

    function seed() {
      if (load(KEYS.ch).length || load(KEYS.cat).length) return;
      const cats = [{ id: 'c1', name: 'Fitness', icon: 'üí™', color: '#ef4444', createdAt: new Date().toISOString() }, { id: 'c2', name: 'Mindfulness', icon: 'üßò', color: '#10b981', createdAt: new Date().toISOString() }, { id: 'c3', name: 'Learning', icon: 'üìö', color: '#6366f1', createdAt: new Date().toISOString() }];
      save(KEYS.cat, cats);
      const pD = n => { const d = new Date(); d.setDate(d.getDate() - n); return d.toISOString().split('T')[0]; };
      const gD = (start, count, skip = 5) => Array.from({ length: count }, (_, i) => { if (i % skip === 0) return null; const d = new Date(start + 'T00:00:00'); d.setDate(d.getDate() + i); return d.toISOString().split('T')[0]; }).filter(Boolean);
      save(KEYS.ch, [
        { id: 'h1', name: '30 Push-ups Daily', description: 'Start each morning strong', categoryId: 'c1', duration: 30, startDate: pD(12), color: '#ef4444', completedDates: gD(pD(12), 12), createdAt: new Date().toISOString() },
        { id: 'h2', name: '10-Min Meditation', description: 'Evening mindfulness session', categoryId: 'c2', duration: 21, startDate: pD(7), color: '#10b981', completedDates: gD(pD(7), 7, 7), createdAt: new Date().toISOString() },
        { id: 'h3', name: 'Read 20 Pages', description: 'Non-fiction daily reading', categoryId: 'c3', duration: 30, startDate: pD(4), color: '#6366f1', completedDates: gD(pD(4), 4, 8), createdAt: new Date().toISOString() },
      ]);
    }

    // Theme Logic
    const themeBtn = document.getElementById('theme-toggle');
    const setTheme = (isLight) => {
      document.documentElement.classList.toggle('light-mode', isLight);
      themeBtn.textContent = isLight ? '‚òÄÔ∏è' : 'üåô';
      localStorage.setItem('strive_theme', isLight ? 'light' : 'dark');
    };
    themeBtn.addEventListener('click', () => setTheme(!document.documentElement.classList.contains('light-mode')));
    if (localStorage.getItem('strive_theme') === 'light' || (!localStorage.getItem('strive_theme') && window.matchMedia('(prefers-color-scheme: light)').matches)) {
      setTheme(true);
    }

    // PWA Logic
    let deferredPrompt;
    const installBtn = document.getElementById('pwa-install');
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = 'block';
    });
    installBtn.addEventListener('click', () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      deferredPrompt.userChoice.then((choice) => {
        if (choice.outcome === 'accepted') installBtn.style.display = 'none';
        deferredPrompt = null;
      });
    });

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').then(reg => {
        reg.onupdatefound = () => {
          const sw = reg.installing;
          sw.onstatechange = () => {
            if (sw.state === 'installed' && navigator.serviceWorker.controller) {
              toast('New update available! Reload to apply.', 'success');
            }
          };
        };
      }).catch(() => { });
    }
    seed();
    renderDashboard();
  </script>
</body>

</html>
